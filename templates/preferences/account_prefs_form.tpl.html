<form class="account_prefs_form" method="post" enctype="multipart/form-data">
    <input type="hidden" name="cat" value="update_account">

    <table class="bordered">
        <tr class="title">
            <th colspan="{$assigned_projects|@count+1}">
                {t}Account Preferences{/t}
                <span class="menu">
                    {include file="help_link.tpl.html" topic="preferences"}
                </span>
            </th>
        </tr>

        {if $avail_langs}
        <tr>
            <th width="190">
                {t}Available Languages{/t}
            </th>
            <td colspan="{$assigned_projects|@count}">
                <select name="language">
                    <option value="en_US">English</option>
                    {html_options options=$avail_langs selected=$current_locale}
                </select>
            </td>
        </tr>
        {/if}

        <tr>
            <th width="190">
                {t}Timezone{/t}
            </th>
            <td colspan="{$assigned_projects|@count}">
                <select name="timezone" class="chosen-select" data-placeholder="{t}Choose a timezone...{/t}">
                    <option></option>
                    {html_options values=$zones output=$zones selected=$user_prefs.timezone}
                </select>
            </td>
        </tr>

        <tr>
            <th width="190">
                {t}Week starts on{/t}:
            </th>
            <td colspan="{$assigned_projects|@count}">
                <label><input type="radio" name="week_firstday" {if $user_prefs.week_firstday != "1"}checked{/if} value="0"> {t}Sunday{/t}</label>
                <label><input type="radio" name="week_firstday" {if $user_prefs.week_firstday == "1"}checked{/if} value="1"> {t}Monday{/t}</label>
            </td>
        </tr>

        <tr>
            <th width="190">
                {t}Display relative dates{/t}:
            </th>
            <td colspan="{$assigned_projects|@count}">
                <label><input type="radio" name="relative_date" {if $user_prefs.relative_date == "1"}checked{/if} value="1"> {t}Yes{/t}</label>
                <label><input type="radio" name="relative_date" {if $user_prefs.relative_date != "1"}checked{/if} value="0"> {t}No{/t}</label>
            </td>
        </tr>

        <tr>
            <th width="190">
                {t}Markdown rendering{/t}:
            </th>
            <td colspan="{$assigned_projects|@count}">
                <label><input type="radio" name="markdown" {if $user_prefs.markdown == "1"}checked{/if} value="1"> {t}Yes{/t}</label>
                <label><input type="radio" name="markdown" {if $user_prefs.markdown != "1"}checked{/if} value="0"> {t}No{/t}</label>
            </td>
        </tr>

        <tr>
            <th width="190">
                {t}Collapse email replies{/t}:
            </th>
            <td colspan="{$assigned_projects|@count}">
                <label><input type="radio" name="collapsed_emails" {if $user_prefs.collapsed_emails == "1"}checked{/if} value="1"> {t}Yes{/t}</label>
                <label><input type="radio" name="collapsed_emails" {if $user_prefs.collapsed_emails != "1"}checked{/if} value="0"> {t}No{/t}</label>
            </td>
        </tr>

        {if $core.current_role != $core.roles.customer}
        <tr>
            <th width="190">
                {t}Automatically close confirmation popup windows?{/t}
            </th>
            <td colspan="{$assigned_projects|@count}">
                <label><input type="radio" name="close_popup_windows" {if $user_prefs.close_popup_windows == "1"}checked{/if} value="1"> {t}Yes{/t}</label>&nbsp;&nbsp;
                <label><input type="radio" name="close_popup_windows" {if $user_prefs.close_popup_windows != "1"}checked{/if} value="0"> {t}No{/t}</label>
            </td>
        </tr>
        {/if}

        {if $core.current_role > $core.roles.customer}
        <tr>
            <td width="190">
                &nbsp;
            </td>
            {foreach from=$assigned_projects key=prj_id item=project_info}
            <td>
                <strong>{$project_info.prj_title}</strong>
            </td>
            {/foreach}
        </tr>

        <tr>
            <th width="190">
                {t}Receive emails when all issues are created?{/t}
            </th>
            {foreach from=$assigned_projects key=prj_id item=project_info}
            <td>
                <label><input type="radio" name="receive_new_issue_email[{$prj_id}]" {if $user_prefs.receive_new_issue_email.$prj_id}checked{/if} value="1">{t}Yes{/t}</label>&nbsp;&nbsp;
                <label><input type="radio" name="receive_new_issue_email[{$prj_id}]" {if not $user_prefs.receive_new_issue_email.$prj_id}checked{/if} value="0">{t}No{/t}</label>
            </td>
            {/foreach}
        </tr>

        <tr>
            <th width="190">
                {t}Receive emails when new issues are assigned to you?{/t}
            </th>
            {foreach from=$assigned_projects key=prj_id item=project_info}
            <td>
                <label><input type="radio" name="receive_assigned_email[{$prj_id}]" {if $user_prefs.receive_assigned_email.$prj_id}checked{/if} value="1">{t}Yes{/t}</label>
                <label><input type="radio" name="receive_assigned_email[{$prj_id}]" {if not $user_prefs.receive_assigned_email.$prj_id}checked{/if} value="0">{t}No{/t}</label>
            </td>
            {/foreach}
        </tr>

        <tr>
            <th width="190">
                {t}Receive notifications for your own actions?{/t}
            </th>
            {foreach from=$assigned_projects key=prj_id item=project_info}
            <td>
                <label><input type="radio" name="receive_copy_of_own_action[{$prj_id}]" {if $user_prefs.receive_copy_of_own_action.$prj_id}checked{/if} value="1">{t}Yes{/t}</label>
                <label><input type="radio" name="receive_copy_of_own_action[{$prj_id}]" {if not $user_prefs.receive_copy_of_own_action.$prj_id}checked{/if} value="0">{t}No{/t}</label>
            </td>
            {/foreach}
        </tr>

        {else}
            <input type="hidden" name="close_popup_windows" value="0">
            <input type="hidden" name="receive_assigned_email" value="0">
            <input type="hidden" name="receive_new_issue_email" value="0">
        {/if}

        <tr>
            <th width="190">
                {t}Refresh Rate for Issue Listing Page{/t}
            </th>
            <td colspan="{$assigned_projects|@count}">
                <input type="text" size="10" name="list_refresh_rate" value="{$user_prefs.list_refresh_rate|escape:"html"}">
                <em>({t}in minutes{/t})</em>
            </td>
        </tr>

        {if $core.current_role > $core.roles.customer}
        <tr>
            <th width="190">
                {t}Refresh Rate for Email Listing Page{/t}
            </th>
            <td colspan="{$assigned_projects|@count}">
                <input type="text" size="10" name="email_refresh_rate" value="{$user_prefs.email_refresh_rate|escape:"html"}">
                <em>({t}in minutes{/t})</em>
            </td>
        </tr>

        <tr>
            <th width="190">
                {t}Email Signature{/t}
            </th>
            <td colspan="{$assigned_projects|@count}">
                <label>
                    {t}Edit Signature{/t}:<br />
                    <textarea name="email_signature" style="width: 97%" rows="10">{$user_prefs.email_signature}</textarea>
                </label>

                <label>
                    {t}Upload New Signature{/t}:
                    <input size="40" type="file" name="file_signature">
                </label><br />

                <label>
                    <input type="checkbox" name="auto_append_email_sig" value="1" {if $user_prefs.auto_append_email_sig == '1'}checked{/if}>
                    {t}Automatically append email signature when composing web based emails{/t}
                </label><br />

                <label>
                    <input type="checkbox" name="auto_append_note_sig" value="1" {if $user_prefs.auto_append_note_sig == '1'}checked{/if}>
                    {t}Automatically append email signature when composing internal notes{/t}
                </label>
            </td>
        </tr>
        {else}
            <input type="hidden" name="email_refresh_rate" value="10">
        {/if}

        <tr class="buttons">
            <td colspan="{$assigned_projects|@count+1}">
                <input type="submit" value="{t}Update Preferences{/t}">
                <input type="reset" value="{t}Reset{/t}">
            </td>
        </tr>
    </table>
</form>
